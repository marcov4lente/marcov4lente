---
layout: article
title: Sending mail PDF attachments in laravel 4
date: 2014-08-10 19:34:54 +0000
description: Swift Mailer, Laravel's built in mail library, makes sending and queuing email quite painless. PDF creation however is not supported out of the box by Laravel, and requires a third party package called barryvdh/laraveldompdf. The barryvdh/laraveldompdf package is essentially a wrapper for the DOMPDF utility which is a useful HTML to PDF converter.
categories: PHP
permalink: articles/sending-mail-pdf-attachments-laravel-4.html
---

## Sending mail with PDF attachments in Laravel 4

Swift Mailer, Laravel's built in mail library, makes sending and queuing email quite painless. PDF creation however is not supported out of the box by Laravel, and requires a third party package called _barryvdh/laraveldompdf_. The _barryvdh/laraveldompdf_ package is essentially a wrapper for the DOMPDF utility which is a useful HTML to PDF converter.

### Installing the PDF package

Install the _barryvdh/laraveldompdf_ package from Packagist by adding it as a requirement to the project's Composer file.

```
"require": {
"laravel/framework": "4.2.*",
"barryvdh/laravel-dompdf": "0.4.*"
```


Afterwards, running the composer update command will update the project's packages, install the _barryvdh/laraveldompdf_ package as well its required dependencies.

```
$ composer update
```


After the Composer update has finished the _barryvdh/laraveldompdf_ package's service provider would need to be registered with the with the application by adding the following item to the `providers` array in the `/app/config/app.php` configuration file.

```
'Barryvdh\DomPDF\ServiceProvider',
```


As well as registering a facade for it in the `aliases` array of the same `/app/config/app.php` configuration file.

```
'PDF' => 'Barryvdh\DomPDF\Facade',
```


### Building the mailing features

All the requirements for sending PDF attachments via email have been now been satisfied. The process of building the mailer may therefore commence. In brief the process outline is as follows:

- Generate a PDF file, using DOMPDF wrapped by the the_barryvdh/laraveldompdf_ package and save it temporarily to disk.
- Email the PDF file via Laravel's built in mail utility.
- Delete the temporary PDF file.

### Generate the PDF file from an HTML string

As outlined above, firstly the PDF file is to be generated and stored to disk. The file is going to be generated by converting a standard HTML document into a PDF document using DOMPDF.

Initially the file's name and storage path is defined . Here the storage path is set the to Laravel's `/app/storage` folder, which is Laravel's default folder where application generated files are stored.

```
$fileName = 'report.pdf';
$filePath = '../app/storage/';
$htmlContent = '

# This is a PDF file

I hope that you find it valuable!

';
```


Now PDF file can be generated and saved to disk.

```
PDF::loadHTML($htmlContent)
    ->setPaper('a4')
    ->setOrientation('portrait')
    ->save(/pre>filePath.$fileName);
```


This will generate a PDF file containing the HTML defined by the `$htmlContent` variable. It's size has been set to A4 and it's orientation to portrait using the `setPaper()` and `setOrientation()` methods respectively.

There are a few other DOMPDF methods available for generating PDF files. Below is a brief list of the methods that may be used.

- `loadHTML()`: Loads an HTML string that is to be converted to a PDF file.
- `loadFile()`: Loads an HTML file that is to be converted to a PDF file
- `setPaper()`: Set the paper size.
- `setOrientation()`: Set the document's orientation, portrait or landscape.
- `save()`: This saves the file.
- `stream()`: This streams the generated file to the client, prompting a file download dialog.

For the purpose of this article, the methods `setPaper()`, `setOrientation()` and `save()` will be used.

### Generate the PDF file from a Blade template

In more complex implementations, Laravel's built in Blade template engine can be used to build the PDF content.

**The Blade template**

```
<meta charset="utf-8">

\# {{ $data['documentHeading'] }}

{{ $data['documentContent'] }}

```


The above Blade template can be saved to the default `app/views` directory.

**The controller:** containing the logic that will convert the Blade template output into a PDF file.

```
$data['documentHeading'] = 'This is a PDF file';
$data['documentContent'] = 'I hope that you find it valuable!';
$htmlContent = View::make('pdf_document_template')->with('data',$data);
```


As before, the file's name and storage path is defined.

```
$fileName = $fileName;
$filePath = '../app/storage/';
```


After which the PDF file is generated and saved to disk.

```
\PDF::loadHTML($htmlContent)
    ->setPaper('a4')
    ->setOrientation('portrait')
    ->save($filePath.$fileName);
```


### Email the PDF file

Again Blade templates are to be used, this time to generate the email content body that is to be sent along side the PDF file via email. The email Blade template will look as follows.

In the controller, Email template's data is defined, namely the `$data['recipientName']` and the `$data['recipientEmail']` fields, as set out in the email's Blade template above.

```
$mailTemplate ='email_template';
$data['recipientName'] = 'Jean Luc Picard';
$data['recipient'Email] = 'JeanLucPicard@ufp.star';
$data['message'] = $message;/h5
```


Then the email's recipients and subject is defined. Here as many recipients as required may be added, by simply adding them to the `$mailRecipients` array where the key represent the recipient's email address and it's value represents the recipient's name.

```
$mailRecipients['JeanLucPicard@ufp.star'] = 'Jean Luc Picard';
$mailRecipients['KathrynJaneway@ufp.star'] = 'Kathryn Janeway';
$mailSubject = 'Mission Report';
$mailMessage = 'Please see the mission report attatched for you order.';
$mailAttachment = $filePath.$fileName;
```


Now the email may finally be sent with the PDF file attached.

```
\Mail::send(
$mailTemplate, $data,
function($mailMessage) use ($mailRecipients, $mailSubject, $mailAttachment)
{
$message->to($mailRecipients)->subject($mailSubject);
$message->attach($mailAttachment);
}
);
```


### Cleaning up

Once the email has been sent, the sent PDF files that are stored on disk may be deleted using PHP's `unlink()` function.

```
unlink(/pre>filePath.$fileName);```


### The code in its entirety

**The PDF Blade template ("pdf_document_template")**

```
<meta charset="utf-8">

\# {{ $data['documentHeading'] }}

{{ $data['documentContent'] }}

```


**The email Blade template (email_template)**

**The controller**

```
// pdf content
$data['documentHeading'] = 'This is a PDF file';
$data['documentContent'] = 'I hope that you find it valuable!';
$htmlContent = View::make('pdf_document_template')->with('data',$data);

// pdf file params
$fileName = $fileName;
$filePath = '../app/storage/';

// generate the pdf file
PDF::loadHTML($htmlContent)
    ->setPaper('a4')
    ->setOrientation('portrait')
    ->save(/pre>filePath.$fileName);

// mail template
$maiTemplate ='email_template';
$data['recipientName'] = 'Jean Luc Picard';
$data['recipient'Email] = 'JeanLucPicard@ufp.star';
$data['messgae'] = $message;

// mail params
$mailRecipients['JeanLucPicard@ufp.star'] = 'Jean Luc Picard';
$mailRecipients['KathrynJaneway@ufp.star'] = 'Kathryn Janeway';
$mailSubject = 'Mission Report';
$mailMessage = 'Please see the mission report attatched for you order.';
$mailAttachment = $filePath.$fileName;

// send the mail
\Mail::send(
    $maiTemplate, $data,
    function($mailMessage) use ($mailRecipients, $mailSubject, $mailAttachment) {
        $message->to($mailRecipients)->subject($mailSubject);
        $message->attach($mailAttachment);
    }
);

// file cleanup
unlink(/pre>filePath.$fileName);
```


### Conclusion

Mail management is generally quite simple in Laravel, thanks to the bundled Swift Mailer library. The same process above may be similarly replicated to deliver other types of attachments to, such as CSVs or image files.


### References

- [https://github.com/barryvdh/laravel-dompdf](/web/20150622102548/https://github.com/barryvdh/laravel-dompdf)
- [http://laravel.com/docs/4.2/mail](/web/20150622102548/http://laravel.com/docs/4.2/mail)

</div>
